<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="" />
    <meta name="generator" content="Maverick 1.0" />
    <meta name="template" content="Galileo" />
    <link rel="alternate" type="application/rss+xml" title="科学生活 &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="科学生活 &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/assets/galileo-ec40839efa.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/assets/ExSearch/ExSearch-182e5a8868.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/d9930557ce51ccf0780d533707f06613.json"
        }
    </script>
    
<title>科学上网 - 科学生活</title>
<meta name="author" content="ste" />
<meta name="description" content="我的智商极限大约就是折腾路由器了。" />
<meta property="og:title" content="科学上网 - 科学生活" />
<meta property="og:description" content="我的智商极限大约就是折腾路由器了。" />
<meta property="og:site_name" content="科学生活" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/ss/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2019-12-25T14:26:00-00.00" />
<meta name="twitter:title" content="科学上网 - 科学生活" />
<meta name="twitter:description" content="我的智商极限大约就是折腾路由器了。" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />

    </head>
    
    <body>
        
        <div class="container">
            <header id="ga-header">
                <div first>
                    <aside id="ga-logo">
                        <a href="/" target="_self">
                            <img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/icon.png" alt="科学生活">
                        </a>
                    </aside>
                    <aside id="ga-brand">
                        <h1 class="brand"><a class="no-style" href="/">科学生活</a></h1>
                        <p>做什么都得走点技术流</p>
                    </aside>
                </div>
                <div second id="ga-nav">
                    <nav class="navs">
                        <ul><li><a class="ga-highlight" href="/" target="_self">首页</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/archives/" target="_self">归档</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/about/" target="_self">关于</a></li><span class="separator">·</span><li><a href="#" target="_self" class="search-form-input ga-highlight">搜索</a></li></ul>
                    </nav>
                    <nav class="social-links">
                        <ul><li><a class="no-style" title="Twitter" href="https://twitter.com/snipersteve" target="_blank"><i class="gi gi-twitter"></i>Twitter</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/snipersteve" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                    </nav>
                </div>
            </header>
            <div class="wrapper">
                
<main>    
    <section class="ga-section ga-content">
        <article class="yue">
            <h1 class="ga-post_title">科学上网</h1>
            <span class="ga-post_meta ga-mono">
                <span>ste</span>
                <time>
                    2019-12-25
                </time>
                
                
            </span>
            <div class="ga-content_body">
                <p>我的智商极限大约就是折腾路由器了。</p>
<p>小时候家里没有电脑，跑去表哥家里玩游戏，那时候是拨号上网，联网之后电话就打不进来了，所以妈妈叫我回家吃饭却打不通电话，只能干着急。</p>
<p>后来自己家里也买了电脑，每次开机都要先拨号，总要等好一会儿才行，经朋友指点装了一个路由器，记得是水星的。在路由上完成拨号，比电脑上来得更快。虽然只是填个宽带账号的事情，还是研究了半天。搞明白之后，还跑去小姑娘家里给人家设置，弄好之后我就很老实地回家了。</p>
<p>读研究生期间上网需要锐捷认证，很蛋疼。想学人家把路由刷openwrt并跑锐捷，但是搞不懂，最后只能在电脑上插个360wifi来解决，给iPad之类的设备提供无线。后来学校把这类wifi硬件都封了，必须用修改版的锐捷才能正常运行，很难受。最后找导师要了他的Teacher帐号，WIFI直连外网，放弃锐捷。</p>
<p>工作后自己租房子住，在淘宝上买刷好PandoraBox的小米路由mini，为的是在路由上实现透明代理。买了之后发现这货操作反人类，费了很大劲才设置好拨号，而且不怎稳定，用了一段时间就闲置了。作为米粉的我又买了小米路由硬盘版，上网性能一般，但好处是能远程下载电影以及自动追美剧，同时学会用samba实现在电视上看路由器里电影，速度也很快。同时顺带了解了NAS这种东西，研究了一下群晖、Gen8之类的产品，以及HyperV、ESXi之类虚拟技术。</p>
<p>然后就忽悠单位买了群晖，主要用于企业数据备份和共享，8盘位，raid 5。一开始用QuickConnect来远程访问，很方便但速度不理想。为了能够相对快速地实现远程访问，专门研究了一下ddns，搞了个花生壳的动态域名。这其实挺傻的，因为单位的专线其实是有公网固定IP的，这是后话，不表。</p>
<p>自己又跟风买了Newifi mini，刷各种固件极为方便，发现老毛子固件真好用，相较openwrt直观太多。在路由上设置好ss后，所有终端免翻，真是居家越货必备良品。同时可以设置adbyby、KMS等功能，十分强大。顺便在阿里买了个域名，用aliddns可以实现远程访问。但因为家里有两台路由，为了用aria功能，又研究了半天端口转发的问题，挺头疼。
<figure class="pswp-item" style="flex: 75.10288065843622" data-width="730" data-height="486"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/2b1102bbe11d865d774ba94332fa4312.jpg" alt="Newifi" /><figcaption>Newifi</figcaption></figure></p>
<p>Newifi用起来各种好，然后开始到处安利，并囤积居奇，买了一打放在家里，送给有需要的朋友。期间上门给导师装了一台，设置好翻墙和去广告，导师表示对其科研有很大帮助，并表示要给我介绍女朋友。我后来又开始买已经下车了的K2/K2P，刷好荒野无灯的固件并配置好搬瓦工的ss线路送朋友，到手插网线就能用。但因为不可描述的原因，不久之后就不能用了，我也不可能上门去维护，后来便放弃了。</p>
<p>我自己则把原先用的Newifi淘汰下来，换成Asus ac66u b1，刷梅林。梅林固件有个插件中心，按需要安装，独立更新，用起来更方便。这货的最大问题是温度常年70度往上，我经常用它来温一下过于冰的可乐。后来专门给它配了个USB风扇，温度降到50度左右。
<figure class="pswp-item" style="flex: 37.8316906747536" data-width="1996" data-height="2638"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/a718830c0d818c26831b4e1f24e83902.jpg" alt="梅林" /><figcaption>梅林</figcaption></figure></p>
<p>顺手把单位里的R8000也刷了梅林，在全所范围内实现ss、kms和去广告，自己方便，别人也方便。配合AP，全面覆盖，无缝漫游。有一次内部开会，有个同事说因为在单位可以上Google，查资料方便，所以很愿意加班。老板听了很满意，频频冲我点头，但并没有给我加工资。</p>
<p>最新的梅林固件开始支持AiMesh，于是我又买了一台66u b1，两台共同组AiMesh，有线回程。然而某天我突然发现自己其实根本不需要无缝漫游，因为家里实在小，一台K2P完全可以覆盖了，而且发热量还小。撤掉两台66u，收进车库里吃灰。
<figure class="pswp-item" style="flex: 78.73626373626374" data-width="1433" data-height="910"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/0383690c69315cfcf8c72ca7d0d73988.png" alt="Aimesh" /><figcaption>Aimesh</figcaption></figure></p>
<hr>
<p>梅林用了好几年，期间很稳定，一直没去动过。不过，科学上网的姿势日新月异，转眼间我已数次换了机场，换了跨栏方案，梅林路由器上的ss不带混淆，已无法用了。于是改为在终端翻，策略组分流，ios用quantumalt，android用surfboard，win用clash。其中clash是我最喜欢的，开源稳定，在PC上用cfw之后几乎再没出过不能上网的情况。
<figure class="pswp-item" style="flex: 88.44339622641509" data-width="1500" data-height="848"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/1790c1de2e6ff98e0f9c674739f8a627.png" alt="clash for windows" /><figcaption>clash for windows</figcaption></figure></p>
<p>偶然了解到旁路方案，本想把一台闲置的MacBook装上surge当网关用，无奈surge太贵买不起。后来经安利买了一个orange pi zero plus，和我早年买的树莓派是一个道理，不过这个更小，而且是千兆口，CPU也更强。刷了群里老竭力改过的PandoraBox固件，已内置了ssr plus，支持订阅和故障转移，非常好用。把xbox网关指向Pi就可以实现翻墙，看Netflix速度很棒，和老婆晚上在家看4K的纸牌屋，很开心。
<figure class="pswp-item" style="flex: 68.62949452840022" data-width="2634" data-height="1919"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/8956bdf983a86a3f2d460f3595c9d227.jpg" alt="pi" /><figcaption>pi</figcaption></figure></p>
<p>正好电信有免费提速到200M的优惠，就办理了，结果提速后家里测速还是只有100M，问了才知道精装修装的交换机是百兆的，真的垃圾。本想买个千兆交换机放弱电箱，后来转念买了台Newifi3，刷lean固件，拆了外壳后勉强可塞进弱电箱，发热量也还好。将Newifi作为主路由，关无线，挂ssr；K2P使用AP模式，连WIFI；Pi专供Xbox，保证视频速度流畅。</p>
<p>这套方案本身挺合理的，只是裸板放弱电箱还是不放心。考虑买一台弱电箱神器UBNT ER-X作为主路由，非常稳定；然后跑一个旁路处理有特殊上网需求的设备，即便这个旁路设备出问题，至少能保证家里主干网络不受影响；然后买几个Velop mesh有线回程作为AP，真是美滋滋。</p>
<p>然而某天出差，临时起意买了个四口的J1900软路由。到手后发现做工真好，被动散热效果就很不错，夏天也仅40多度。而且大小适中，正好可以放进弱电箱，把新三给换下来。性能上，跑分可以跑三万多，但是看Netflix的速度基本还是一样，估计瓶颈在线路本身的速度。软路由配合K2P的AP，硬件上暂不需要折腾了。
<figure class="pswp-item" style="flex: 66.66666666666667" data-width="4032" data-height="3024"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/e8a1ea7a124e9cf101350467be1dc2dd.jpg" alt="J1900" /><figcaption>J1900</figcaption></figure></p>
<p>J1900买来就是刷好了lean openwrt的成品软路由，用了一段时间下来十分稳定。不过翻墙工具更新很快，openwrt平台上除了ssr plus、clash之外，又冒出了passwall、hello world等新工具，功能更全面，但是我通过安装编译好的ipk包时总是会出现缺少依赖的情形。更彻底的办法是直接更新固件，但软路由要更新固件却很麻烦，尤其是我的软路由是放在弱电箱里，要拿出来特别麻烦。有一次尝试盲刷，然而固件的lan口与我原先的不一致，最终还是只能拿出来配置，十分蛋疼。
<figure class="pswp-item" style="flex: 66.66666666666667" data-width="1280" data-height="960"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/66aac90ca0f69568e3b0b101d500a8ac.jpg" alt="打开弱电箱" /><figcaption>打开弱电箱</figcaption></figure></p>
<p>更科学的方法是虚拟化安装，但J1900这块CPU不支持网卡直通，故不考虑。转而用那台刷了小钢炮的N1测试了docker安装op，确实很方便，更新固件只需要pull一下最新镜像，远程配置一下即可，而不必去动机器本身。
<figure class="pswp-item" style="flex: 58.05714285714286" data-width="1016" data-height="875"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/60448a53ed36ea029f3fea60a955c4d1.png" alt="N1 OP" /><figcaption>N1 OP</figcaption></figure></p>
<p>因此虚拟化安装是更科学的系统安装方式，打算以后换个软路由，比如3865U之类。网上看到还有一种思路是先PVE虚拟化后，跑一个Openwrt，再跑一个Linux定期pull最新源码并编译后自动更新Openwrt，这个操作太骚，学不来。</p>
<p>Pi暂时闲置了，作为测试clash的专用机器。clash及luci clash尚处于测试阶段，有一些小毛病，不如终端上的版本稳定。最新版本clash上开始引入fake-ip模式，但我并没有搞懂，大约就是防DNS污染的一种方法。总体能用，成熟后可以部署到主路由上。
<figure class="pswp-item" style="flex: 50.0" data-width="2160" data-height="2160"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/e601716888ae03b2dcd2f51815022145.jpg" alt="luci-clash" /><figcaption>luci-clash</figcaption></figure></p>
<p>535期间没事干，翻出早年买的一个小黄路由——GL MT300N V2，在吃灰多年后，经更新固件终于可以支持华为4G网卡，插上即可上网。其固件本质为openwrt，套了个一定制的界面。进ssh刷上ssr plus，可用，但性能较弱。并没有想到可用场景，就当玩玩吧。
<figure class="pswp-item" style="flex: 70.91503267973856" data-width="1302" data-height="918"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/3b2b2494f147d31f0ce0f2892e551c15.jpg" alt="随身路由" /><figcaption>随身路由</figcaption></figure></p>
<hr>
<p>为了能远程看到家里的网络情况，打电话给电信改了桥接，然后用主路由PPPOE拨号，并在阿里云买了一个域名，用于ddns；搞了证书，可以远程https访问到路由器管理页面。这个操作看起来并没有什么卵用，但实际上打开了一扇大门。</p>
<p>实现远程访问后，在家里搞了一台群晖415+，4盘4T跑raid5，约10T的可用容量。用cloudsync来下载百度盘和Google Drive上的资源（cloudsync真是神器）。
<figure class="pswp-item" style="flex: 85.25316455696202" data-width="1347" data-height="790"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/d8a8cd4baba0839e9fd904498071dfc7.jpg" alt="cloudsync" /><figcaption>cloudsync</figcaption></figure></p>
<p>在群晖上跑docker也很不错，跑了clash和<a href="https://docs.ginuerzh.xyz/gost/">gost</a>，后者是一个转发代理的工具，可以实现将连到这台nas的特定流量转发到clash，从而实现代理中转，有一定用处。
<figure class="pswp-item" style="flex: 91.62790697674419" data-width="394" data-height="215"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/dd0f4c8b0003dc00623c77fd5d97d38e.png" alt="gost" /><figcaption>gost</figcaption></figure></p>
<p>最终还是说回Clash。在2019年这一年里，眼看着Clash这个开源软件一步步走向全平台（iOS除外），我现在电脑、手机、路由器、NAS都是用Clash了。再次感叹开源社区的强大，在Dreamacro写了Clash内核后，又有各位高手写了各平台的UI，各有特色。</p>
<p>除各平台UI程序外，因为Clash配置相对复杂，又有人写了转换程序，可以把服务商的ss/v2订阅转换成自己喜欢的配置并可以自动更新。
<figure class="pswp-item" style="flex: 86.1557478368356" data-width="1394" data-height="809"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/a47519502a5de57d34c15c83b69d368d.png" alt="subconverter" /><figcaption>subconverter</figcaption></figure></p>
<p>此外，还有一个Clash的管理界面，我也很喜欢，方便查看实时网速、流量以及日志等。
<figure class="pswp-item" style="flex: 88.15426997245179" data-width="1280" data-height="726"><img src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/archives/assets/71755d754143251e958174a477de2e88.jpg" alt="clash-dashboard" /><figcaption>clash-dashboard</figcaption></figure></p>
<p>但开源社区也有一些不那么舒服的事情。今天碰巧看到关于shadowsocks发展史的一篇<a href="https://github.com/JadaGates/ShadowsocksBio">文章</a>，让人唏嘘不已。其中ss和ssr的故事再一次重演，发生在clash和clashr上。Dreamacro写的clash为开源项目，但不支持ssr协议；因很多机场只提供ssr节点，广大小白用户希望支持ssr协议的呼声很高；lvguangfa在clash核心上加了ssr支持，闭源，向机场主收费，被人肉，被迫开源后退出。历史总是惊人的相似。</p>
<p>我现在属于拿来主义，只会拿开源社区的东西来用；希望以后也有能力可以去提pr甚至自己写个有用的程序，也为开源社区作点贡献。</p>
<hr>
<p>我感叹网络技术真是深不见底，越到底层我越搞不懂，这大约是我智商的极限了，如果有空我得去读一读TCP/IP，了解一下底层原理。不过这种软硬结合的玩法真的有趣，学习效果也很好，我已然将其视为一种乐趣，而超过实现科学上网功能这一初衷。</p>
<p>这一感觉和网友<a href="https://twitter.com/i/web/status/1126165698978271232">@cxiaoji</a>说的很像：</p>
<blockquote><p>我对数据结构有非常美好的回忆。我真正开始理解编程就是在贵系蹭的数据结构课。老师没打开过教材，上课就一个编辑器，从头写一个类，一边讲一边往里面添方法。讲完编译，测试，通过，正好下课。我期末要熬图根本没工夫复习的，但是这门课学的东西一点都没忘。</p>
</blockquote>

            </div>
        </article>
        <div id="ga-tags">
    
</div>
    </section>

    
<section id="ga-content_pager">

    <div class="next">
        <a class="ga-highlight" href="/archives/reading/">科学阅读</a>
        <p class="yue">看书这个事情也要讲究科学性，我对于科学性的追求，一开始都关注在设备上，先后买过Nook、Kindle以及iPad Pro等，但每一样其实都看得不多。</p>
    </div>


    <div class="prev">
        <a class="ga-highlight" href="/archives/first-post/">Hello World!</a>
        <p class="yue">暂时不知道要写什么。</p>
    </div>

</section>


    

</main>

                <footer class="ga-mono" id="ga-footer">
                    <section>
                        <span id="ga-uptime"></span>
                        <span class="brand">科学生活</span>
                    </section>
                    <section>
                        <p class="copyright">
                            <span>Copyright © 2020 伪装兽</span>
                            <span>Powered by <a no-style href="https://github.com/AlanDecode/Maverick" target="_blank">Maverick & Galileo</a></span>
                        </p>
                        <div class="copyright">
                            <span class="footer-addon">
                                
                            </span>
                            <nav class="social-links">
                                <ul><li><a class="no-style" title="Twitter" href="https://twitter.com/snipersteve" target="_blank"><i class="gi gi-twitter"></i>Twitter</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/snipersteve" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                            </nav>
                        </div>
                    </section>
                    <script>
                        var site_build_date = "2019-12-25T10:50+08:00"
                    </script>
                    <script src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/assets/galileo-d8a0a06eff.js"></script>
                </footer>
            </div>
        </div>
    </div>
        
        
        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">
            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>
            <div class="pswp__ui pswp__ui--hidden">
                <div class="pswp__top-bar">
                    <div class="pswp__counter"></div>
                    <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                    <button class="pswp__button pswp__button--share" title="Share"></button>
                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                          <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                          </div>
                        </div>
                    </div>
                </div>
                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div> 
                </div>
                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                </button>
                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                </button>
                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/assets/ExSearch/ExSearch-493cb9cd89.js"></script>
    
    <!--katex-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/assets/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/assets/katex.min.js"></script>
    <script>
    mathOpts = {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "\\[", right: "\\]", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\(", right: "\\)", display: false}
        ]
    };
    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/snipersteve/Blog@gh-pages/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
    </body>
</html>